pattern:
  name: "Verifiable Token-Based Authentication (JWT)"
  id: "01_01_003"
  description: "A subject is identified based on a token that contains sufficient information to determine the correct principal, verified through digital signature or MAC"
  
dependencies:
  - fastapi
  - python-jose[cryptography]
  - PyJWT
  - cryptography

repo_metadata_file:
 - python_Pypi_mutual_dependents_fastapi_pyjwt.jsonl


roles:
  enforcer:
    description: "Ensures the requested action is only performed if the Subject is successfully authenticated"
    queries:
      - query: "HTTPBearer Depends"
        description: "Bearer token enforcement"
        priority: high
      - query: " Depends OAuth2PasswordBearer"
        description: "HTTP authorization credentials dependency"
        priority: high
      - query: HTTPAuthorizationCredentials Security
        description: "Authorization credentials extraction"
        priority: medium
      

  verifier:
    description: "Manages the verification of whether a token is valid"
    queries:
      - query: "jwt decode algorithms"
        description: "JWT token verification"
        priority: high
      
      - query: "jwt ExpiredSignatureError"
        description: "Token verification functions"
        priority: high

      - query: "jwt InvalidTokenError"
        description: "Direct JWT decode calls"
        priority: high

      - query: "jwt.exceptions DecodeError"
        description: "JWT decode error handling"
        priority: medium

      - query: "revoke.*token"
        description: "JWT expired signature error handling"
        priority: medium

  cryptography_manager:
    description: "Provides cryptographic primitives for MAC-based tokens (HMAC)"
    queries:
      - query: "jwt encode HS256"
        description: "JWT encoding with HMAC"
        priority: high

      - query: "jwt encode RS256"
        description: "RSA signature algorithm configuration"
        priority: high

      - query: "generate.*signature"
        description: "JWT verification with HMAC"
        priority: high

      - query: "verify.*signature"
        description: "JWT verification with HMAC"
        priority: high
    
    description: "Provides cryptographic primitives for digitally signed tokens (RSA)"
    queries:
      - query: "jwt.encode RS256 private_key"
        description: "JWT encoding with RSA signature"
        priority: high
      
      - query: "jwt.decode public_key RS256"
        description: "JWT verification with public key"
        priority: high
      
      - query: "algorithm RS256 jwt"
        description: "RSA signature algorithm configuration"
        priority: high
      
      - query: "RS256 RS384 RS512 jwt"
        description: "RSA algorithm variants"
        priority: medium

  key_manager:
    description: "Rotate keys"
    queries:
      - query: "rotate.*key"
        description: "Private key loading"
        priority: medium

  token_generator:
    description: "Manages the generation of new tokens"
    queries:
      - query: "create.*token datetime"
        description: "Access token creation functions"
        priority: high
      
      - query: "secrets token_urlsafe"
        description: "Secure token generation"
        priority: medium

  registrar:
    description: "Provides the Subject a token after successful authentication"
    queries:
      - query: "app post token create_access_token"
        description: "Token issuance endpoints"
        priority: high
      
      - query: "return access token bearer"
        description: "Token response formatting"
        priority: high
      


endpoints:
  token_issuance:
    queries:
      - "@app.post /token"
      - "async def login_for_access_token"
      - "return {\"access_token\": access_token, \"token_type\": \"bearer\"}"
  
  token_refresh:
    queries:
      - "@app.post /refresh /token/refresh"
      - "def refresh_token verify_token"
  
  protected_endpoint:
    queries:
      - "async def read_users_me token: str = Depends"
      - "current_user = Depends(get_current_user)"

token_features:
  expiration:
    queries:
      - "exp datetime.utcnow"
      - "expires_delta timedelta"
      - "ACCESS_TOKEN_EXPIRE_MINUTES"
  
  claims:
    queries:
      - "sub username"
      - "payload.get(\"sub\")"
      - "to_encode.update exp iat"
  
  algorithms:
    hmac:
      queries:
        - "HS256"
        - "HS384"
        - "HS512"
    
    rsa:
      queries:
        - "RS256"
        - "RS384"
        - "RS512"


